<?php if($sandbox == 'zerowine'):?>
<script src="<?php echo $asset_url;?>js/jqueryFileTree.js" type="text/javascript"></script>
<link href="<?php echo $asset_url;?>css/jqueryFileTree.css" rel="stylesheet" type="text/css" media="screen" />
<?php endif;?>
<script type="text/javascript" src="<?php echo $asset_url;?>js/jcache.js"></script>
<div class="sandboxes">
	<div class="sandbox"><a href="<?php echo base_url().'malware/view_report/'.$md5.'/commercial';?>" class="button <?php echo ($sandbox == 'commercial') ? 'active' : '';?>">Sandbox 1</a></div>
	<div class="sandbox"><a href="<?php echo  base_url().'malware/view_report/'.$md5.'/zerowine';?>" class="button <?php echo ($sandbox == 'zerowine') ? 'active' : '';?>">Sandbox 2</a></div>
</div>
<br clear="all"/>

<h2 class="title">Analysis Report - <?php echo $filename; if($filename != $md5) echo '(MD5 :'.$md5.')';?></h2>
<br />
<div style="clear: both;">&nbsp;</div>


<div class="entry">
	<div class="container">
	<?php if($sandbox == 'commercial'):?>
	<ul class="tabs">
        <li><a href="#basic_info">Summary</a></li>
        <li><a href="#file_info">File Activity</a></li>
        <li><a href="#registry_info">Registry Activity</a></li>
        <li><a href="#network_info">Network Activity</a></li>
		<li><a href="#all_process_info">Process Details</a></li>
		<li><a href="#download_info">Downloads</a></li>
    </ul>
    <div class="tab_container">
		<div id="basic_info" class="tab_content"> </div>
		<div id="file_info" class="tab_content"></div>
		<div id="registry_info" class="tab_content"></div>
		<div id="network_info" class="tab_content"> </div>
		<div id="all_process_info" class="tab_content"> </div>
		<div id="download_info" class="tab_content"></div>
		</div>
	</div>
	<?php endif;?>
	<?php if($sandbox == 'zerowine'):?>
	<ul class="tabs">
        <li><a href="#basic_info">Details</a></li>
    </ul>
    <div class="tab_container">
		<div id="details" class="tab_content"> 
			<div id="zerowine_directory_tree"></div>
			<div id="zerowine_file_content">
				<h3></h3>
				<textarea id="file_content" cols="137" rows="25" readonly="readonly"></textarea>
				<iframe id="download_iframe" src="" style="display:none; visibility:hidden;"></iframe>
			</div>
		</div>
		<br /><br />
	</div>
		
	</div>
	<?php endif;?>
</div>
<script type="text/javascript">
$.jCache.maxSize = 20;
$(document).ready(function() {

	//Default Action
	$(".tab_content").hide(); //Hide all content
	$("ul.tabs li:first").addClass("active").show(); //Activate first tab
	$(".tab_content:first").show(); //Show first tab content
	
	<?php if($sandbox == 'commercial'):?>
	// Loading summary on load
	/* Fetch the content using ajax */
	$(".tab_content:first").html('<div id="loading"> <img src="<?php echo $asset_url;?>images/loading.gif" border="0"/> </div>');
	$.ajax({
		url: "<?php echo base_url();?>malware/get_analysis_content",
		type: 'POST',
		success: function(data){
			$(".tab_content:first").html(data);
			
			// Set the item in cache
			$.jCache.setItem('#basic_info', data);
			
			return false;
			
			
		},
		data: "sandbox=<?php echo $sandbox;?>&file=<?php echo $md5;?>&section=basic_info"
	});

	
	//On Click Event
	$("ul.tabs li").click(function() {
		var $this = $(this);
		
		// If user is clicking on the active tab itself, simply return false.
		if($this.hasClass('active')){
			return false;
		}
		
		var activeTab = $this.find("a").attr("href"); //Find the rel attribute value to identify the active tab + content
		$("ul.tabs li").removeClass("active"); //Remove any "active" class
		$this.addClass("active"); //Add "active" class to selected tab
		
		$(".tab_content").hide(); //Hide all tab content
		$(activeTab).html('<div id="loading"> <img src="<?php echo $asset_url;?>images/loading.gif" border="0"/> </div>');
		$(activeTab).fadeIn(); //Fade in the active content
		
		// Check for the item in cache
		 var cache = $.jCache.getItem(activeTab);
		 
		 if(typeof(cache) != 'undefined'){
		 	
		 	$(activeTab).html(cache);
		 }else{
				/* Fetch the content using ajax */
				$.ajax({
					url: "<?php echo base_url();?>malware/get_analysis_content",
					type: 'POST',
					success: function(data){
						$(activeTab).html(data);
						
						// Set the item in cache
						$.jCache.setItem(activeTab, data);
						
						return false;
					},
					data: "sandbox=commercial&file=<?php echo $md5;?>&section="+$(this).find("a").attr("href").replace('#',"")
				});
		 }
		return false;
	});
	
	<?php endif;?>
	
	
	<?php if($sandbox == 'zerowine'):?>
	$('#zerowine_directory_tree').fileTree({ file: '<?php echo $md5;?>', root: '', script: '<?php echo base_url().'malware/get_analysis_content';?>', folderEvent: 'click', expandSpeed: 1, collapseSpeed: 1 }, function(file) {
		handle_file(file);
	});
	clear();
	function handle_file(f){
		var chunks = f.split(".");
		var ext = chunks[chunks.length-1];
		
		var chunks = f.split("/");
		var file_name = chunks[chunks.length-1];
		clear();
		if(ext == "reg" || ext == "rpt" || ext == "update-timestamp"){
			$('#zerowine_file_content textarea').val('Loading....');
			$.ajax({
				url: "<?php echo base_url();?>malware/get_file",
				type: "GET",
				success: function (data){
					$('#zerowine_file_content h3').html("File name: "+file_name);
					$('#zerowine_file_content textarea').val(data);
				},
				data: {file : f, type: "content"}
			});
		}else{
			$("#download_iframe").attr("src","<?php echo base_url();?>malware/get_file?type=download&file="+f);

		}
	}
	
	function clear(){
		$('#zerowine_file_content h3').html('');
		$('#zerowine_file_content textarea').val('');
	}
	function l(msg){
		console.log(msg);
	}
	<?php endif;?>
	
	
	
	$('.tab_content').css('min-height', '400px');
});
</script>
