<script type="text/javascript" src="<?php echo $asset_url;?>js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="<?php echo $asset_url;?>js/jquery.miniTip.min.js"></script>
<link href="<?php echo $asset_url;?>css/miniTip.min.css" rel="stylesheet" />
<script type="text/javascript" src="<?php echo $asset_url;?>js/jquery.colorbox-min.js"></script>
<link href="<?php echo $asset_url;?>css/colorbox.css" rel="stylesheet" />
<?php // p($sandbox1);
$i = 0;?>
<div id="middle">
		<!--div id="left-column">
			<?php echo $logged_in;?>
			<h3>Malware Analysis Report</h3>
			<ul class="nav">
				<li ><strong><a href="<?php echo base_url();?>malware/all">Malware Listing</a></strong></li>
			</ul>
		</div-->
		<div id="center-column">
			<div class="top-bar">
				<h1>Malware Analysis Report</h1>
				<div class="breadcrumbs"><a href="<?php echo base_url();?>home">Dashboard</a> / <a href="<?php echo base_url();?>malware/all">Malware Listing</a> / <a href="<?php echo base_url();?>malware/view_report/<?php echo $file_name?>">Malware Analysis Report</a></div>
			</div><br />
		
		<?php FlashNotice::display();?>
		<table id="one-column-emphasis">
		    <colgroup>
		    	<col class="oce-first" />
		    </colgroup>
		    <tbody>
		    	<tr>
		        	<td width="30%" class="white">File name</td>
		            <td><?php echo $file_name;?></td>
		        </tr>
		    	<tr>
		        	<td width="30%" class="white">Date Received</td>
		            <td><?php echo $received_date;?></td>
		        </tr>
		        <tr>
		        	<td class="white">Email Sender</td>
		            <td><?php echo $email_sender;?></td>
		        </tr>
		        <tr>
		        	<td class="white">Is analyzed? </td>
		            <td><?php echo ($is_analyzed == YES) ? 'Yes' : 'No';?></td>
		        </tr>
		         <tr>
		        	<td class="white">File Count</td>
		            <td><?php echo $m_count;?></td>
		            
		        </tr>
		    </tbody>
		</table>
		<?php foreach ($sandboxes as $sandbox) :?>
			<?php if($sandbox == 'sandbox1')	:?>
				
				<h3><?php echo $sandbox1['name'];?></h3>
				<?php if (isset($sandbox1['cab_url']) || array_key_exists('cab_url', $sandbox1)):?>
					<?php if($sandbox1['cab_url']):?><span><a class="button" href="<?php echo $sandbox1['cab_url'];?>">Download Cab</a></span>&nbsp;&nbsp;<?php endif;?>
				<?php endif;?>
				<?php if (isset($sandbox1['pcap_url']) || array_key_exists('pcap_url', $sandbox1)):?>
					<?php if($sandbox1['pcap_url']):?><span><a class="button" href="<?php echo $sandbox1['pcap_url'];?>">Download Pcap</a></span><?php endif;?>
				<?php endif;?>
				
			 <br /><br />
			 <?php if (isset($sandbox1['xml_data']) || array_key_exists('xml_data', $sandbox1)):?>
			 <div id="tabs" style="padding:0px;margin:0px;">
			    <ul style="padding:0px;" class="tabs">
			      <?php if(count($sandbox1['xml_data']['basic_info']) > 0):?>
			      	<li><a href="#basic">Basic Info</a></li>
			      <?php endif;?>
			      <?php if(count($sandbox1['xml_data']['calltree']) > 0):?>
			      <li><a href="#call-tree">Call Tree</a></li>
			      <?php endif;?>
			      <?php if(count($sandbox1['xml_data']['processes']) > 0):?>
			      <li><a href="#processes">Processes</a></li>
			      <?php endif; ?>
			      <?php if(count($sandbox1['xml_data']['network_info']) > 0):?>
			      <li><a href="#network">Network Info</a></li>
			      <?php endif; ?>
			      <li><a href="#running-processes">Running Processes</a></li>
			    </ul>
				<?php if(count($sandbox1['xml_data']['basic_info']) > 0):?>
			    <div id="basic">
			      <h3 >Basic Analysis Information</h3>
			      
			      		<table cellpadding="3" cellspacing="5" border="0" width="100%">
			      		<?php foreach($sandbox1['xml_data']['basic_info'] as $attr => $val):?>
			      					<tr>
			      						<td width="20%"><strong><?php echo ucfirst($attr);?></strong> </td>
			      						<td><?php echo $val;?></td>
			      					</tr>
			      		<?php endforeach;?>
			      		</table>
			      
			    </div>
			    <?php endif;?>
			    <?php if(count($sandbox1['xml_data']['calltree']) > 0):?>
			    <div id="call-tree">
			      <h3>Call Tree</h3>
			      <?php $str = '&nbsp;&nbsp;&nbsp;&nbsp;';foreach($sandbox1['xml_data']['calltree'] as $process): ?>
			      		<p style="margin-left:<?php echo $process['level']*20 ?>px" ><?php echo (isset($process['filename'])) ? '<strong>Index:</strong>'.$process['index'].';<strong>PID:</strong>'.$process['pid'].';<strong>Filename</strong>:'.$process['filename'] : '<strong>Index</strong>:'.$process['index'].';<strong>PID:</strong>'.$process['pid'];?>&nbsp;&nbsp;
			      		<a style="text-decoration:underline;color:blue;" href="javscript:" id="tip<?php echo $process['index'];?>">View Details</a></p>
			      		<?php $details='';$details = '<table cellpadding="3" cellspacing="5" border="0" width="100%">';?>
			      		<?php foreach($process as $attr => $val):?>
			      				<?php if(($attr != 'level') && ($attr != 'filename')):?>
			      					<?php $details .= '<tr><td width="20%"><strong>'.ucfirst($attr).'</strong> </td><td>'. $val.'</td></tr>';?>
			      				<?php endif;?>
			      		<?php endforeach;?>
			      		<?php $details .= '</table>';?>
			      		<script type="text/javascript">
			      		$(document).ready(function(){
							$('#tip<?php echo $process['index'];?>').miniTip({
							      //title: 'Title Bar',
							      content: '<?php echo $details;?>',
							      delay: 100,
							      anchor: 's',
							      event: 'hover',
							      fadeIn: 100,
							      fadeOut: 2,
							     // aHide: true,
							      maxW: '250px',
							      offset: 1,
							      
							    });
			      		});	
						</script>
			      		
			      <?php endforeach;?>
			    </div>
			    <?php endif;?>
			    
			    <?php if(count($sandbox1['xml_data']['processes']) > 0):?>
			    <div id="processes">
			      <h3>Processes</h3>
			      <?php $processes = $sandbox1['xml_data']['processes'];
			      		foreach($processes as $pIndex => $process):?>
			      			<ul><strong><?php echo 'Process '.$pIndex;?></strong>
			      				<?php foreach ($process as $section => $sectionData):?>
			      					<li  style="margin-left:25px">
			      					<a href="<?php echo base_url();?>malware/getProcessInfo/<?php echo $file_name;?>/<?php echo $sandbox;?>/<?php echo $pIndex;?>/<?php echo $section;?>" class="process_section"><?php echo ucwords(str_replace('_',' ', $section));?></a>
			      					</li>
			      				<?php endforeach;?>
			      			</ul>
			      		
			      
			      
			      		<?php endforeach;?>
			    </div>
			    <script type="text/javascript">
					
				</script>
			    <?php endif;?>
			    
			    <?php if(count($sandbox1['xml_data']['network_info']) > 0):?>
			    <div id="network">
			    	<h3>Network Info</h3>
			    	 <?php $n_nodes = $sandbox1['xml_data']['network_info'];
			      		foreach($n_nodes as $pIndex => $process):?>
			      			<ul><strong><?php echo 'Process '.$pIndex;?></strong>
			      				<?php foreach ($process as $section => $sectionData):?>
			      					<li  style="margin-left:25px">
			      					<?php if($section != 'winsock_section'):?>
			      					<a href="<?php echo base_url();?>malware/getProcessInfo/<?php echo $file_name;?>/<?php echo $sandbox;?>/<?php echo $pIndex;?>/<?php echo $section;?>" class="process_section"><?php echo ucwords(str_replace('_',' ', $section));?></a>
			      					<?php else: ?>
			      					<a href="<?php echo base_url();?>malware/getSocketInfo/<?php echo $file_name;?>/<?php echo $sandbox;?>/<?php echo $pIndex;?>/<?php echo $section;?>" class="process_section"><?php echo ucwords(str_replace('_',' ', $section));?></a>
			      					<?php endif;?>
			      					</li>
			      				<?php endforeach;?>
			      			</ul>
			      		
			      
			      
			      		<?php endforeach;?>
			    </div>
			    <?php endif; ?>
			    
			    
			     <div id="running-processes">
			      <h3>Tab 3</h3>
			    </div>
			  </div>
			  <?php else:?>
			  <div class="info">We do not have any anaysis results to show you</div>
			  <?php endif;?>	
				
				
							
			<?php endif;?>
		
		
		<?php endforeach;?>
		
		</div>
	</div>
<script type="text/javascript">

$(document).ready(function(){
	$('#tabs div').hide();
	$('#tabs div:first').show();
	$('#tabs ul.tabs li:first').addClass('active');
	$('#tabs ul.tabs li a').click(function(){
		$('#tabs ul.tabs li').removeClass('active');
		$(this).parent().addClass('active');
		var currentTab = $(this).attr('href');
		$('#tabs div').hide();
		$(currentTab).show();
		return false;
	});
	
	$(".process_section").colorbox({transition:"fade", width:"95%", height:"75%"});
});

</script>